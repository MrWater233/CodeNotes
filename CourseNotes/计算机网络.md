# 第一章 概述

## 互联网的前身

ARPANET

## 互联网的主要功能

把许多网络通过路由器接在一起

## 几种数据交换技术和他们的特点

### 电路交换（面向连接交换）

建立连接（占用通话资源）→通过（一直占用通信资源）→释放连接（归还通信资源）

#### 特点

在通过的全部时间内，通话的两个用户始终占用端到端的通信资源。

#### **缺点**

线路的传输效率低

### 报文交换

#### 特点

- 先将整个报文传送到相邻结点，全部存储下来以后查找转发表，转发到下一个结点

- 不预先分配传输带宽

### 分组交换

采用**存储转发**技术，将报文分组，每个分组称为**包**，通过路由器来进行分组交换

#### 特点

单个分组传送到相邻结点，存储下来以后查找转发表，转发到下一个结点

## 网络的分类方式

### 按照网络作用范围分类

1. 广域网（WAN）
2. 城域网（MAN）
3. 局域网（LAN）
4. 个人局域网（PAN）

### 按照网络的使用者分类

1. 公用网
2. 专用网

## 网络的体系结构

### 网络协议三要素

1. 语法：数据与控制信息的结构或格式
2. 语义：即需要发出盒中控制信息，完成何种动作以及做出何种响应
3. 同步：即时间实现顺序的详细说明

### 网络的体系结构

1. 应用层（报文）
2. 运输层：TCP（报文段），UDP（用户数据报）
3. 网络层（包）
4. 数据链路层（帧）
5. 物理层（比特）

# 第二章 物理层

## 基本概念

1. 机械特征：指明接口所用接线器的各种规程
2. 电器特征：指明接口电缆的各条线上出现的电压的范围
3. 功能特征：指明某条先上出现某一电平的电压的意义
4. 过程特征：指明对于不同功能的各种可能事件的出现顺序

## 基带信号调制方法

### 基带调制（编码）

将波形进行变换，能够与信道特征相适应

### 带通调制

将信号频率范围搬移到较高的频段

#### 方法

1. 调幅（振幅随着基带数字信号而变化）
2. 调频（频率随着基带数字信号而变化）
3. 调相（载波初始相位随着基带数字信号而变化）

## 香农公式

$$C=Wlog_2(1+S/N)$$

$C:$信道的极限传输速率

$W:$信道的带宽（$Hz$）

$S:$信道所传信号的平均功率

$N:$信道内部的高斯噪声功率

### 公式表明

信道的带宽或者信道中信噪比越大，信息的极限传输速率越高。

## CDMA

$a·b=\frac{1}{m}\sum_{i=1}^ma_ib_i$

$S$代表站$S$的码片向量

$T$代表站$T$的码片向量

$S$和$T$相互正交，即$S·T=0$

$S·S=1$

$T·T=1$

$m_1$数据进入$S$基站，那么数据就变为$m_1·S$

$m_2$数据进入$T$基站，那么数据就变为$m_2·T$

最后可以通过这个方法得到不同基站的数据：$(m_1·S+m_2·T)·S=m_1$

- 结果为1说明发送1
- 结果为-1说明发送0
- 结果为0说明没有发送

## 物理层设备

集线器

# 第三章 数据链路层

## 三个基本问题

### 封装成帧

在一个数据的前后添加首部和尾部，首部尾部最重要的是**帧定界（SOU、EOT）**

### 透明传输

采用有效方法解决数据中出现了和帧界定符一样的比特组合。

字节填充法：在数据中的**SOU或者EOT**前面加入转义字符**ESC**

### 差错检测

#### CRC循环冗余校验

设添加$n$位冗余码

先将数据$M$进行二进制的模2运算（$2^n*M$即在$M$后面添加$n$个$0$）

再除以$n+1$位的素数$P$（进行异或运算，相同→0，不同→1），得到商为$Q$余数为$R(n位)$

将$Q$作为冗余码拼接（加上，因为模2以后，后$n$位为0，所以可以理解为拼接）在数据后面发送

接收方再将整个数据去除以余数，如果余数为0，那么说明数据基本没问题

## 点对点协议PPP

### 特点

-  互联网用户通常需要连接到某个 ISP 之后才能接入到互联网，PPP 协议是用户计算机和 ISP 进行通信时所使用的数据链路层协议 

### 帧格式

| F               | A       | C       | 协议        | 信息部分   | FCS    | F               |
| --------------- | ------- | ------- | ----------- | ---------- | ------ | --------------- |
| 0x7E标志字段(2) | 地址(1) | 控制(1) | 上层协议(2) | $\leq1500$ | CRC(2) | 0x7E标志字段(1) |

### 工作状态

1. 个人电脑向ISP发送链路控制协议LCP分组（封装成多个PPP帧）
2. 网络控制协议NCP给电脑分配IP地址
3. NCP释放网络层连接，收回IP
4. LCP释放链路层连接
5. 释放物理层连接

## 局域网的数据链路层

### 网络的拓扑

- 星形网
- 环形网
- 总线网

### 数据链路层的两个子层

- 逻辑链路控制(LLC)子层（纠错，现在一般将纠错放在运输层）
- 媒体接入控制(MAC)子层
-  概要: 与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关，不管采用何种协议的局域网对 LLC 子层来说都是透明的 所以以后一般不考虑 LLC 子层 

### CSMA/CD协议

意思：载波监听多点接入/差错检测

#### 多点接入：

总线型网络，许多计算机以多点接入的方式连接在一起

#### 载波监听

站点一直监测信道

#### 碰撞检测

边发送边监听，一旦发现了碰撞，就等待一段随机时间再重新发送

$2t$时间内没有碰撞就说明信道空闲（$t$为单程端到端的传播时延），$2t$也被称为**争用期**，也被称为**碰撞窗口**

规定凡是长度小于64字节的帧都是由于冲突而异常中止的无效帧

##### 截断二进制指数退避

1. 从离散的整数集合$[0,1,...,(2^k-1)]$中随机取一个数，记为$r$，重传就推后$r$倍的争用期。

   $k=Min[重传次数,10]$

2. 当重传16次都不能成功的时候，就丢弃该帧，并向高层报告。

## 以太网

### 以太网特点

1. 尽最大努力交付，不可靠
2. 纠错由高层实现，检测到错误就直接丢弃
3. 采用曼彻斯特编码

### 以太网的信道利用率

帧本身发送时间为$T_0$

争用期为$2t$

发送一帧的时间为$T_0+2t$

所以极限信道利用率$S_{max}=\frac{T_0}{T_0+t}=\frac{1}{1+a}$

- $S_{max}$的意义在于只有当$a$远小于1才能尽可能提高信道利用率

### 以太网的Mac层

- Mac地址为48位的全球地址

- 帧的类型：

1. 单播帧（一对一）
2. 广播帧（一对全体）
3. 多播帧（一对多）

### 以太网帧格式

| 目的地址 | 源地址 | 类型 | 数据    | FSC    |
| -------- | ------ | ---- | ------- | ------ |
| 6        | 6      | 2    | 46-1500 | 校验 4 |

- 如果数据长度过小需要填充
- FSC采用CRC校验

### 扩展以太网

#### 物理层扩展以太网（总线型）

**使用CSMA/CD协议，半双工工作**

- 多个集线器连成更大的局域网
  - 集线器组成的更大局域网都在一个碰撞域中
    - 优点
      - 使原来属于不同碰撞域的局域网上的计算机能够进行跨碰撞域通信
      - 扩大了局域网的地理范围
    - 缺点
      - 碰撞域增大，但是总吞吐量并没有提高
      - 如果不同的碰撞域使用了不同的以太网技术，那么就不能用集线器把他们连起来

#### 链路层扩展以太网（星形）

- 网桥，工作在链路层，根据帧的目的MAC查找地址表再进行转发，在转发帧之前执行CSMA/CD协议
  - 优点
    -  过滤通信量。 
    - 扩大了物理范围。
    - 提高了可靠性。
    - 可互连不同物理层、不同 MAC 子层和不同速率（如10 Mb/s 和 100 Mb/s 以太网）的局域网。
  - 缺点
    - 存储转发增加了时延。
    - 在MAC 子层并没有流量控制功能。
    - 具有不同 MAC 子层的网段桥接在一起时时延更大。
    - 网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴。
- 路由器，**不使用CSMA/CD协议，全双工工作**
  - 具有自学习能力，不需要手动配置交换表，交换表中存储MAC地址到端口的映射。
  - 工作流程
    - A给B发送一个帧（此时路由器中都没有A,B的映射，若有映射则第二步就不需要广播，直接通过映射转发即可）
    - A的数据进入路由器，路由器再路由表中存储A的映射，同时广播该帧
    - C,D收到该帧丢弃，B收下这个帧（过滤）

### 虚拟局域网

#### 概念

虚拟出很多小的局域网，将网络隔开，各个VLAN不能通过MAC访问，只能通过IP

#### 特点

- 不同的VLAN属于不同的广播域，可避免广播风暴
- 一个VLAN对应一个子网段

# 第四章 网络层

## 网络层提供的两种服务

- 虚电路服务
  - 面向连接
  - 差错可以靠网络负责，也可以靠用户负责
- 数据报服务（现在使用的服务）
  - 面向无连接
  - 差错靠用户负责

## 网络层设计思路

向上提供简单灵活的、无连接的、尽最大努力交付的数据报服务

## 网际协议IP

### 与IP协议配套使用的三个协议

- 地址解析协议ARP（位于IP协议下层）
- 国际控制报文协议ICMP（位于IP协议上层）
- 国际组管理协议IGMP（位于IP协议上层）

### 分类的IP地址

- A类
  - 前8位网络号，后24位主机号(子网掩码：255..0.0.0)
  - 前8位为(0xxxxxxx)，所以首字节是1-126
  - 0为保留地址，127为本地环回测试
  - 最大可指派网络数$2^7-2$
- B类
  - 前16位网络号，后16位主机号(子网掩码：255.255.0.0)
  - 前8位为(10xxxxxx)，所以首字节为128-191
  - 128.0.0.0不指派，最小网络地址为128.1.0.0
  - 最大可指派网络数$2^{14}-1$
- C类
  - 前24位网络号，后8位主机号(子网掩码：255.255.255.0)
  - 前8位为(110xxxxx)，所以首字节为192-223
  - 192.0.0.0不指派，最小网络地址为129.1.0.0
  - 最大可指派网络数$2^{21}-1$

主机号**全0**表示网络号

主机号**全1**表示所在网络上的所有主机

#### 注意

- 同一个局域网中的主机或者路由器的IP地址中的网络号是一样的
- 网桥连接的网段也只能有一个网络号
- 路由器具有两个及两个以上的IP地址
- 两个路由器直接相连可以不分配IP地址

### ARP协议

#### 使用原因

**同一个局域网**下已经知道了一个机器的IP地址，需要知道这个机器的MAC地址

#### 过程

1. A在局域网内广播发送ARP请求分组，说明自己的IP,MAC和对方的IP
2. 局域网所有的主机都收到ARP请求分组，但是无关的主机不会理睬。所以ARP请求分组时广播分组，响应分组是单播
3. B将自己的IP,MAC发送为ARP响应分组给A
4. A将B的IP到MAC的映射写入自己ARP高速缓存中

#### 要点

- 每个主机都有一个ARP高速缓存，里面有局域网内部各主机和路由器的IP地址到MAC地址的映射表

- ARP高速缓存中的映射有**生存时间**，超过时间的项目就从高速缓存中删除

- ARP协议只解决**同一个局域网**下的映射问题

- 如果不在同一个局域网，那么也不需要请求对方的MAC地址。

  只需要途径的主机和路由器各自执行的ARP协议，只保存自己局域网的IP到MAC映射就可实现逐级转发。

### IP数据包的格式

![image](https://github.com/MrWater233/CodeNotes/blob/master/CourseNotes/images/IP%E6%8A%A5%E5%A4%B4.png?raw=true)

IP数据包通常以32位（4字节）为单位描述的

- 版本(4b)：IPV4、IPV6
- 首部长度(4b)：
  - 最大值为15
  - 每增加1表示增加32b(4kb)。
  - 因为首部固定长度为20kb，所以最小值为5
- 区分服务(8b)：用来获得更好的服务，一般不用
- 总长度(16b)：包括首部长度和数据部分长度

---

- 标识(16b)：计数器，每产生一个数据报就+1，不是序号。
- 标志(3b)：
  - 最低位为MF。MF=1表示后面还有分片，MF=0表示是最后一个分片
  - 中间一位为DF。意思是不能分片；DF=0时才能分片
- 片偏移(13b)：分片以后，片在原分组中的相对位置。8kb为偏移单位。

---

- 生存时间(8b)：TTL，表示数据包在网络中的寿命，0时就丢弃。
- 协议(8b)：指明运输层协议
- 首部校验和(16b)：只校验首部，不包括数据部分
  - 将首部拆成若干个16k序列，所有序列进行反码算数运算相加，最后取反码填入
  - 接收方重复上述步骤，若正确，则结果为0

---

- 源地址(32b)
- 目的地址(32b)

### IP转发分组的流程

路由表中每一条路由主要时以下的信息：(目的网络地址，下一跳地址)